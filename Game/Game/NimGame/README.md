# Nim 遊戲

## 概述

Nim Game 是一個基於 HTML、CSS 和 JavaScript 的網頁遊戲，實現了一個單堆物件的減法遊戲。玩家輪流從一個物件堆中取走 1 至指定最大數量的物件（預設為 3），遊戲目標根據規則不同而變化：普通模式下，最後取走物件的玩家獲勝；誤取模式下，最後取走物件的玩家失敗。遊戲支持兩種模式：雙人對戰（玩家 1 對玩家 2）或對 AI（玩家 1 對 AI）。AI 有簡單和困難兩種難度級別。

### 主要特性
- **單堆遊戲**：僅使用一個物件堆，初始物件數可配置（1–20），以網格形式排列（例如，15 個物件排列為約 4x4 網格）。
- **玩家命名**：玩家分別為「玩家 1」和「玩家 2」，在對 AI 模式下，玩家 2 顯示為「AI」。
- **動態 UI**：根據遊戲模式，玩家 2 的已取物件標籤顯示為「玩家 2 已取：」或「AI 已取：」。
- **自動開始**：點擊「取 X」按鈕（例如「取 1」）或按下鍵盤數字（1 至最大取數）會自動開始遊戲，無需單獨點擊「開始遊戲」按鈕。
- **配置選項**：
  - 物件數：1–20
  - 每回合最大取數：1–5
  - 遊戲模式：雙人對戰或對 AI
  - AI 難度：簡單（隨機取）或困難（基於模數策略）
  - 遊戲規則：普通（最後取者勝）或誤取（最後取者敗）
- **視覺反饋**：物件以圓點表示，已取物件顯示在玩家 1 和玩家 2/AI 的區域。
- **輔助功能**：支持鍵盤快捷鍵（1 至最大取數）、ARIA 屬性、焦點管理和響應式設計。
- **其他功能**：深色模式切換、控制台日誌記錄（無螢幕日誌）、無進度條。

### 檔案結構
- `nim-game.html`：包含 HTML 結構、嵌入的 JavaScript 和 CSS 連結。
- `nim-game.css`：定義遊戲的樣式，包括網格物件排列、響應式設計和深色模式。

## 使用方法

1. 將 `nim-game.html` 和 `nim-game.css` 置於同一目錄。
2. 在網頁瀏覽器中打開 `nim-game.html`。
3. 配置遊戲設定：
   - 選擇物件數（1–20，預設 20）。
   - 設置每回合最大取數（1–5，預設 3）。
   - 選擇遊戲模式（雙人對戰或對 AI，預設雙人）。
   - 若選擇對 AI，設置難度（簡單或困難，預設簡單）。
   - 選擇規則（普通或誤取，預設普通）。
4. 點擊「取 X」按鈕（例如「取 1」）或按下鍵盤數字（1 至最大取數）開始遊戲，無需點擊「開始遊戲」按鈕。
5. 輪流取物件，直到堆中無物件，根據規則判定勝負。
6. 使用「重置」按鈕重新開始，或更改設定後點擊「開始遊戲」以新配置開始。
7. 點擊右上角的月亮/太陽圖標切換深色模式。

## 函數詳細說明

以下是 `nim-game.html` 中 JavaScript 的主要函數及其功能：

### `showWarning(message)`
- **功能**：顯示警告訊息於螢幕（`.warning` 區域，持續 3 秒）並記錄至控制台。
- **參數**：
  - `message`：要顯示的警告訊息（例如「物件數必須介於 1 和 20 之間。」）。
- **行為**：
  - 將訊息設置到 `.warning` 元素並添加 `show` 類，顯示訊息。
  - 以格式 `[時間戳]: 訊息` 記錄到控制台（例如 `[6:30:43 PM]: 遊戲因模式變更重置。`）。
  - 3 秒後隱藏警告訊息。
- **使用場景**：輸入無效（例如物件數 > 20）、模式變更、難度變更、規則變更或配置變更時觸發。

### `toggleDifficulty()`
- **功能**：根據遊戲模式切換 AI 難度選擇器的可見性，並在模式變更時重置遊戲。
- **行為**：
  - 讀取 `#mode` 選擇器的值（`two-player` 或 `vs-ai`）。
  - 若模式改變且遊戲進行中，更新 `isAIMode`，設置 `#taken-2` 標籤為「AI 已取：」或「玩家 2 已取：」，呼叫 `resetGame`，並顯示警告。
  - 顯示或隱藏 `#difficulty-group`（AI 難度選擇器）。
- **使用場景**：當用戶改變遊戲模式時觸發。

### `initializePile()`
- **功能**：初始化物件堆，設置網格排列和「取 X」按鈕。
- **行為**：
  - 讀取 `#objects` 和 `#max-take` 的值，設置 `initialObjects` 和 `maxTake`。
  - 更新 `#max-take-display` 和 `#taken-2` 標籤（根據 `isAIMode`）。
  - 清空 `#pile-container`，創建一個 `.pile` 元素，包含：
    - `.pile-label`：顯示「物件：X/Y」（當前/初始物件數）。
    - `.objects-display`：以網格排列物件。
    - `.take-buttons`：生成「取 1」至「取 min(objects, maxTake)」按鈕。
  - **網格排列**：
    - 計算列數：`columns = ceil(sqrt(initialObjects))`（例如，15 物件，`sqrt(15) ≈ 3.87`，取 4 列）。
    - 計算行數：`rows = ceil(initialObjects / columns)`（例如，`15 / 4 = 3.75`，取 4 行）。
    - 設置 `gridTemplateColumns = repeat(columns, 10px)` 和 `gridTemplateRows = repeat(rows, 10px)`。
    - 創建 `initialObjects` 個 `.object` 圓點，填滿網格。
  - 呼叫 `updateTakenDisplay` 更新已取物件顯示。
- **使用場景**：頁面載入、遊戲開始或重置時觸發。

### `updatePile()`
- **功能**：更新物件堆的顯示，保持初始網格排列。
- **行為**：
  - 更新 `.pile-label` 為「物件：X/Y」。
  - 清空 `.objects-display`，創建 `objects` 個 `.object` 圓點，保持原始網格結構（不重新計算行列）。
  - 更新 `.take-buttons`：
    - 若 `objects > 0`，生成「取 1」至「取 min(objects, maxTake)」按鈕，禁用無效按鈕。
    - 若 `objects = 0`，顯示「空」標籤。
- **使用場景**：每次取物件後觸發。

### `updateTakenDisplay()`
- **功能**：更新玩家 1 和玩家 2/AI 的已取物件顯示。
- **行為**：
  - 為 `#taken-1` 和 `#taken-2` 的 `.objects-display` 生成分別 `taken1` 和 `taken2` 個 `.object` 圓點。
- **使用場景**：初始化、取物件或重置後觸發。

### `startGame()`
- **功能**：開始或重新開始遊戲，驗證輸入並初始化狀態。
- **行為**：
  - 讀取配置（物件數、最大取數、模式、難度、規則）。
  - 驗證輸入：
    - 物件數：1–20。
    - 最大取數：1–5 且不大於物件數。
    - 若無效，顯示警告並聚焦無效輸入，返回 `false`。
  - 設置 `gameActive = true`，`currentPlayer = '1'`，`taken1 = taken2 = 0`，`objects = initialObjects`。
  - 更新 UI：顯示回合指示、隱藏 AI 思考訊息、顯示重置按鈕、清空狀態訊息。
  - 呼叫 `initializePile`。
  - 若為對 AI 模式且當前為玩家 2，觸發 AI 移動。
  - 返回 `true` 表示成功開始。
- **使用場景**：點擊「開始遊戲」按鈕或首次點擊「取 X」按鈕/按鍵時觸發。

### `handleTake(count)`
- **功能**：處理玩家取物件的動作，若遊戲未開始則自動開始。
- **參數**：
  - `count`：要取的物件數（1 至 `maxTake`）。
- **行為**：
  - 若 `!gameActive`，呼叫 `startGame`；若返回 `false`（無效輸入），退出。
  - 檢查是否為 AI 回合（`isAIMode && currentPlayer === '2'`）或物件不足（`objects < count`），若是則退出。
  - 減去 `count` 個物件，更新 `taken1` 或 `taken2`。
  - 呼叫 `updatePile` 和 `updateTakenDisplay`。
  - 檢查遊戲結束（`checkGameEnd`）：
    - 若結束，根據規則顯示勝負（普通：當前玩家勝；誤取：對方勝，考慮 AI 標籤）。
    - 設置 `gameActive = false`，隱藏 AI 思考訊息。
  - 若未結束，切換 `currentPlayer`，更新回合指示。
  - 若為對 AI 模式且下一回合為玩家 2，觸發 AI 移動。
  - 將焦點設置到 `.pile` 元素。
- **使用場景**：點擊「取 X」按鈕或按下鍵盤數字時觸發。

### `checkGameEnd()`
- **功能**：檢查遊戲是否結束。
- **行為**：
  - 返回 `objects === 0`。
- **使用場景**：每次取物件後檢查。

### `makeAIMove()`
- **功能**：執行 AI 的移動。
- **行為**：
  - 檢查遊戲是否有效（`gameActive`、`isAIMode`、當前為玩家 2）。
  - 根據難度選擇移動（`getEasyMove` 或 `getHardMove`）。
  - 若有有效移動：
    - 減去 `move.count` 個物件，更新 `taken2`。
    - 呼叫 `updatePile` 和 `updateTakenDisplay`。
    - 檢查遊戲結束，顯示勝負（考慮 AI 標籤）。
    - 若未結束，切換到玩家 1，更新回合指示。
  - 隱藏 AI 思考訊息。
- **使用場景**：對 AI 模式下玩家 2 的回合觸發。

### `getEasyMove()`
- **功能**：為簡單難度 AI 生成隨機移動。
- **行為**：
  - 生成有效移動清單（1 至 `min(objects, maxTake)`）。
  - 隨機選擇一個移動，返回 `{ count: X }`。
  - 若無有效移動，返回 `null`。
- **使用場景**：簡單難度 AI 回合。

### `getHardMove()`
- **功能**：為困難難度 AI 生成最佳移動。
- **行為**：
  - 若 `objects <= maxTake`：
    - 普通模式：取所有物件（`count: objects`）。
    - 誤取模式：留一個物件（`count: objects - 1` 或 1）。
  - 否則，計算 `remainder = objects % (maxTake + 1)`：
    - 若 `remainder === 0`，取 `maxTake` 個物件。
    - 否則，取 `remainder` 個物件，使剩餘物件為 `(maxTake + 1)` 的倍數。
  - 返回 `{ count: X }`。
- **使用場景**：困難難度 AI 回合。

### `resetGame()`
- **功能**：重置遊戲到初始狀態。
- **行為**：
  - 清除 AI 計時器。
  - 設置 `gameActive = true`，`currentPlayer = '1'`，`taken1 = taken2 = 0`，`objects = initialObjects`。
  - 更新回合指示，隱藏 AI 思考訊息，清空狀態訊息。
  - 呼叫 `updatePile` 和 `updateTakenDisplay`。
  - 若為對 AI 模式且當前為玩家 2，觸發 AI 移動。
- **使用場景**：點擊「重置」按鈕或配置變更（模式、難度、規則、物件數、最大取數）時觸發。

### `toggleDarkMode()`
- **功能**：切換深色模式。
- **行為**：
  - 切換 `body` 的 `dark-mode` 類。
  - 更新 `#dark-mode-toggle` 的文字為太陽（深色模式）或月亮（淺色模式）。
- **使用場景**：點擊右上角切換按鈕時觸發。

### `updateHints()`
- **功能**：更新輸入提示並驗證配置，若改變則重置遊戲。
- **行為**：
  - 讀取 `#objects` 和 `#max-take` 的值。
  - 驗證：
    - 物件數：1–20。
    - 最大取數：1–5 且不大於物件數。
    - 若無效，顯示警告。
  - 若有效，更新 `#max-take-display`。
  - 若遊戲進行中且配置改變，重置遊戲並顯示警告。
  - 更新提示文字（「範圍：1 到 20」等）。
- **使用場景**：輸入物件數或最大取數時觸發。

## AI 難度級別說明

### 簡單難度 (`getEasyMove`)
- **策略**：隨機選擇一個有效移動（1 至 `min(objects, maxTake)`）。
- **行為**：
  - 生成所有可能的取數清單。
  - 隨機選取一個數量。
  - 例如，若 `objects = 5`，`maxTake = 3`，可能選擇 1、2 或 3。
- **特點**：
  - 無策略性，模擬新手玩家。
  - 提供輕鬆的遊戲體驗，玩家容易獲勝。
- **適用場景**：休閒玩家或測試遊戲。

### 困難難度 (`getHardMove`)
- **策略**：使用基於模數的數學策略，確保最佳移動。
- **行為**：
  - 若 `objects <= maxTake`：
    - 普通模式：取所有物件，立即獲勝。
    - 誤取模式：取 `objects - 1` 個物件，留 1 個迫使對手取走並失敗（若 `objects = 1`，取 1）。
  - 否則：
    - 計算 `remainder = objects % (maxTake + 1)`。
    - 若 `remainder = 0`，取 `maxTake` 個物件，保持不利局面。
    - 否則，取 `remainder` 個物件，使剩餘物件為 `(maxTake + 1)` 的倍數，迫使對手進入不利局面。
  - 例如，若 `objects = 15`，`maxTake = 3`：
    - `15 % (3 + 1) = 15 % 4 = 3`。
    - 取 3 個物件，剩 12（4 的倍數），對手無法避免進入不利局面。
- **特點**：
  - 理論上無敵，若 AI 先手且初始物件數非 `(maxTake + 1)` 的倍數，AI 必勝。
  - 提供挑戰性體驗，適合熟悉遊戲策略的玩家。
- **適用場景**：進階玩家或策略測試。

## 技術細節

- **網格排列**：物件以 CSS 網格顯示，初始計算行列數以接近正方形，保持視覺平衡。取物件時不重新排列，避免視覺干擾。
- **響應式設計**：小螢幕（<480px）下，輸入欄垂直堆疊，物件縮小至 8px，按鈕和文字調整以適應。
- **輔助功能**：
  - ARIA 屬性（如 `aria-label`）確保按鈕可被螢幕閱讀器識別。
  - 鍵盤快捷鍵（1 至 `maxTake`）支持快速操作。
  - 焦點管理（點擊後焦點回到 `.pile`）提升鍵盤導航。
- **控制台日誌**：所有警告訊息記錄至控制台，格式為 `[時間戳]: 訊息`，便於除錯。
- **深色模式**：通過 CSS 類切換，提供舒適的夜間體驗。

## 測試建議

1. **自動開始**：
   - 載入頁面後，點擊「取 1」按鈕，確認遊戲開始，回合切換至玩家 2 或 AI 移動。
   - 使用鍵盤按 1，確認與按鈕行為一致。
2. **無效輸入**：
   - 設置物件數為 25 或最大取數為 6，點擊「取 X」，確認顯示警告且遊戲不開始。
   - 設置最大取數大於物件數，確認警告。
3. **網格排列**：
   - 測試不同物件數（9、15、20），確認網格平衡（例如 15 為 ~4x4）。
   - 取物件後，確認圓點從右下角移除，網格不變。
4. **AI 行為**：
   - 簡單難度：確認 AI 隨機取物件。
   - 困難難度：設置 `maxTake = 3`，物件數 = 15，確認 AI 取 3 個物件（剩 12），保持策略。
5. **模式切換**：
   - 從雙人切換到對 AI，確認 `#taken-2` 標籤變為「AI 已取：」，遊戲重置。
6. **響應式和輔助功能**：
   - 在小螢幕上測試，確認佈局適應。
   - 使用鍵盤導航和螢幕閱讀器，確認可訪問性。

## 未來改進建議

- **動畫效果**：為取物件添加淡出動畫，提升視覺吸引力。
- **主題物件**：將圓點替換為石頭、硬幣等圖像，增加主題感。
- **音效**：為按鈕點擊和遊戲結束添加音效。
- **輸入預驗證**：在點擊「取 X」前禁用無效按鈕，避免警告。
- **進階 AI**：添加中間難度，結合隨機和策略移動。

## 版權與許可

本遊戲由 xAI 的 Grok 3 協助開發，僅供教育和娛樂用途。請尊重原始程式碼的版權，並在分發前取得許可。

---
*最後更新：2025 年 6 月 18 日*