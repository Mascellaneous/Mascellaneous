<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inflation vs Price Level: The Balloon Model</title>
    <style>
        :root {
            --primary: #3b82f6;
            --danger: #ef4444;
            --success: #22c55e;
            --neutral: #64748b;
            --bg: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: #1e293b;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f1f5f9;
            text-align: center;
        }
        .header h1 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; color: var(--neutral); font-size: 0.9rem; }

        /* The Visualization Stage */
        .stage {
            height: 350px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #ffffff 0%, #f1f5f9 100%);
            overflow: hidden;
            border-bottom: 1px solid #e2e8f0;
        }

        /* The Balloon */
        #balloon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #60a5fa 0%, #2563eb 100%);
            border-radius: 50%;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.2), 10px 20px 30px rgba(0,0,0,0.15);
            position: relative;
            transition: width 0.1s linear, height 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
        }

        /* Particles for Air Flow Visualization */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.6;
        }

        /* Controls Section */
        .controls {
            padding: 30px;
            background: white;
        }

        .slider-container {
            margin-bottom: 30px;
            text-align: center;
        }

        input[type=range] {
            width: 100%;
            max-width: 400px;
            height: 10px;
            border-radius: 5px;
            background: #cbd5e1;
            outline: none;
            -webkit-appearance: none;
        }
        
        /* Custom Slider Thumb */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 0 0 1px #cbd5e1, 0 4px 6px rgba(0,0,0,0.1);
        }

        .rate-display {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            font-variant-numeric: tabular-nums;
        }

        .rate-label {
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--neutral);
        }

        /* Dashboard Metrics */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .metric-box {
            padding: 15px;
            border-radius: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
        }

        .metric-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: var(--neutral);
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            margin-top: 5px;
        }

        /* Scenario Buttons */
        .scenarios {
            padding: 20px;
            background: #f1f5f9;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .scenario-btn {
            background: white;
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            color: #475569;
        }

        .scenario-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: #eff6ff;
        }

        /* Dynamic Explanation Box */
        .explanation-box {
            margin: 20px;
            padding: 15px;
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            border-radius: 4px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .highlight {
            font-weight: bold;
            color: #d97706;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Inflation & Price Level Lab</h1>
        <p>Use the slider to control the "Air Pump" (Inflation Rate)</p>
    </div>

    <!-- The Visual Stage -->
    <div class="stage" id="stage">
        <div id="balloon">
            <span id="balloon-label">100</span>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <div class="slider-container">
            <div class="rate-label">Inflation Rate (Pump Speed)</div>
            <div class="rate-display" id="rate-display">0%</div>
            <input type="range" id="inflation-slider" min="-5" max="5" step="0.5" value="0">
            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: #94a3b8;">
                <span>Deflation (Air Out)</span>
                <span>Stability</span>
                <span>Inflation (Air In)</span>
            </div>
        </div>

        <div class="dashboard">
            <div class="metric-box">
                <div class="metric-title">Price Level (Balloon Size)</div>
                <div class="metric-value" id="price-text">Current: 100.00</div>
                <div id="price-status" class="status-badge" style="background: #94a3b8;">Unchanged</div>
            </div>
            <div class="metric-box">
                <div class="metric-title">Inflation Rate Trend</div>
                <div class="metric-value" id="rate-trend-text">Stable</div>
                <div style="font-size: 0.8rem; color: #64748b; margin-top:5px;">Change in pump setting</div>
            </div>
        </div>
    </div>

    <!-- Live Explanation -->
    <div class="explanation-box" id="explanation">
        Set the inflation rate to start the simulation.
    </div>

    <!-- Scenarios -->
    <div class="scenarios">
        <div style="width: 100%; text-align: center; margin-bottom: 5px; font-size: 0.8rem; font-weight: bold; color: #64748b;">TRY THESE EXPERIMENTS:</div>
        <button class="scenario-btn" onclick="setScenario(2)">1. Positive Inflation</button>
        <button class="scenario-btn" onclick="setScenario(-2)">2. Negative Inflation</button>
        <button class="scenario-btn" onclick="setScenario(0)">3. Zero Inflation</button>
        <button class="scenario-btn" onclick="runTrickScenario()">4. The "Tricky" Case (-5% to -1%)</button>
    </div>
</div>

<script>
    // --- State ---
    let priceLevel = 100;
    let inflationRate = 0;
    let previousRate = 0;
    let isRunning = true;
    
    // --- DOM Elements ---
    const balloon = document.getElementById('balloon');
    const balloonLabel = document.getElementById('balloon-label');
    const slider = document.getElementById('inflation-slider');
    const rateDisplay = document.getElementById('rate-display');
    const priceText = document.getElementById('price-text');
    const priceStatus = document.getElementById('price-status');
    const rateTrendText = document.getElementById('rate-trend-text');
    const explanation = document.getElementById('explanation');
    const stage = document.getElementById('stage');

    // --- Core Logic Loop ---
    // Runs 30 times per second to simulate time passing
    setInterval(() => {
        if (!isRunning) return;

        // 1. Math: Update Price Level based on Inflation Rate
        // We divide by a large number (600) to make the speed visually followable
        const changeFactor = 1 + (inflationRate / 600);
        priceLevel = priceLevel * changeFactor;

        // Safety caps to keep balloon visible on screen
        if (priceLevel < 20) priceLevel = 20; 
        if (priceLevel > 300) priceLevel = 300;

        // 2. Visuals: Update Balloon Size
        // We map price level 100 to 100px.
        balloon.style.width = `${priceLevel}px`;
        balloon.style.height = `${priceLevel}px`;
        balloonLabel.innerText = Math.round(priceLevel);

        // 3. Visuals: Update Text
        priceText.innerText = `Current: ${priceLevel.toFixed(2)}`;
        
        // 4. Visuals: Create Particles (Air)
        if (inflationRate !== 0) {
            createParticle();
        }

    }, 33);

    // --- Particle System (The "Air") ---
    function createParticle() {
        // Don't create too many particles
        if (Math.random() > 0.3) return;

        const p = document.createElement('div');
        p.className = 'particle';
        
        const centerX = stage.offsetWidth / 2;
        const centerY = stage.offsetHeight / 2;
        
        // Random angle
        const angle = Math.random() * Math.PI * 2;
        const distance = 150; // Start/End distance from center

        if (inflationRate > 0) {
            // INFLATION: Particles move IN (Green)
            p.style.backgroundColor = '#22c55e';
            // Start far away
            const startX = centerX + Math.cos(angle) * distance;
            const startY = centerY + Math.sin(angle) * distance;
            p.style.left = startX + 'px';
            p.style.top = startY + 'px';
            
            stage.appendChild(p);

            // Animate to center
            const animation = p.animate([
                { transform: 'translate(0,0)', opacity: 1 },
                { transform: `translate(${-Math.cos(angle)*distance}px, ${-Math.sin(angle)*distance}px)`, opacity: 0 }
            ], {
                duration: 10000 / Math.abs(inflationRate * 2), // Faster rate = faster particles
                easing: 'linear'
            });

            animation.onfinish = () => p.remove();
        } else {
            // DEFLATION: Particles move OUT (Red)
            p.style.backgroundColor = '#ef4444';
            // Start at center (approximate edge of balloon)
            const balloonRadius = priceLevel / 2;
            const startX = centerX + Math.cos(angle) * balloonRadius;
            const startY = centerY + Math.sin(angle) * balloonRadius;
            
            p.style.left = startX + 'px';
            p.style.top = startY + 'px';
            
            stage.appendChild(p);

            // Animate outward
            const animation = p.animate([
                { transform: 'translate(0,0)', opacity: 1 },
                { transform: `translate(${Math.cos(angle)*distance}px, ${Math.sin(angle)*distance}px)`, opacity: 0 }
            ], {
                duration: 10000 / Math.abs(inflationRate * 2),
                easing: 'linear'
            });

            animation.onfinish = () => p.remove();
        }
    }

    // --- Interaction Logic ---
    slider.addEventListener('input', (e) => {
        updateState(parseFloat(e.target.value));
    });

    function updateState(newRate) {
        previousRate = inflationRate;
        inflationRate = newRate;

        // Update UI
        rateDisplay.innerText = inflationRate > 0 ? `+${inflationRate}%` : `${inflationRate}%`;
        rateDisplay.style.color = inflationRate > 0 ? '#ef4444' : (inflationRate < 0 ? '#3b82f6' : '#64748b');
        
        // Determine Trend
        let trend = "Stable";
        if (inflationRate > previousRate) trend = "Increasing";
        else if (inflationRate < previousRate) trend = "Decreasing";
        
        rateTrendText.innerText = trend;

        // Determine Price Status Badge
        if (inflationRate > 0) {
            priceStatus.innerText = "Increasing";
            priceStatus.style.background = "#ef4444"; // Red for inflation warning
        } else if (inflationRate < 0) {
            priceStatus.innerText = "Decreasing";
            priceStatus.style.background = "#3b82f6"; // Blue for cooling
        } else {
            priceStatus.innerText = "Unchanged";
            priceStatus.style.background = "#64748b";
        }

        generateExplanation(trend);
    }

    function generateExplanation(trend) {
        let text = "";

        // 1. Explain the Rate vs Previous Rate
        if (trend === "Increasing") {
            text += `You turned the pump knob <strong>UP</strong>. `;
        } else if (trend === "Decreasing") {
            text += `You turned the pump knob <strong>DOWN</strong>. `;
        } else {
            text += `The pump setting is unchanged. `;
        }

        // 2. Explain the Effect on Balloon
        if (inflationRate > 0) {
            text += `Because the rate is <strong>positive</strong> (+${inflationRate}%), air is flowing <strong>IN</strong>. The balloon (Price Level) will get bigger.`;
            
            if (trend === "Decreasing") {
                text += `<br><br><span class="highlight">KEY CONCEPT:</span> Even though you turned the knob DOWN (Disinflation), the rate is still positive, so the balloon is STILL growing... just slower than before.`;
            }
        } else if (inflationRate < 0) {
            text += `Because the rate is <strong>negative</strong> (${inflationRate}%), air is leaking <strong>OUT</strong>. The balloon (Price Level) will get smaller.`;

            if (trend === "Increasing") {
                text += `<br><br><span class="highlight">KEY CONCEPT:</span> Even though you turned the knob UP (from a lower negative to a higher negative), the rate is still negative. The balloon is STILL shrinking... just slower than before.`;
            }
        } else {
            text += `The rate is <strong>Zero</strong>. The valve is closed. The balloon size stays exactly where it is.`;
        }

        explanation.innerHTML = text;
    }

    // --- Scenarios ---
    function setScenario(rate) {
        slider.value = rate;
        updateState(rate);
    }

    function runTrickScenario() {
        // Reset
        priceLevel = 200; // Start big
        setScenario(-5); // Start leaking fast
        
        explanation.innerHTML = "<strong>Watch closely:</strong> The rate is -5%. The balloon is shrinking fast (Deflation).<br>In 3 seconds, we will increase the rate to -1%.";

        setTimeout(() => {
            setScenario(-1);
            explanation.innerHTML = "<strong>Look!</strong> The rate INCREASED (from -5% to -1%). <br>But is the balloon growing? <strong>NO.</strong><br>It is still shrinking, because the rate is still negative. It's just shrinking slower.";
        }, 3000);
    }

    // Initialize
    updateState(0);

</script>

</body>
</html>